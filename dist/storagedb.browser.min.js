var storagedb=function(e){"use strict";function t(e){if(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.length||(n[0]=null),e.apply(void 0,n)}}function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function r(e){for(var t=arguments.length,o=Array(t>1?t-1:0),c=1;c<t;c++)o[c-1]=arguments[c];for(var u=0;u<o.length;u++){var i=o[u];for(var s in i)i.hasOwnProperty(s)&&("object"===n(i[s])?e[s]="object"===n(e[s])?r(e[s],i[s]):i[s]:e[s]=i[s])}return e}e=e&&e.hasOwnProperty("default")?e.default:e;var o=function(n,r){var o=n.name,c=n.id,u=void 0,i=void 0;try{r?(u=e.sessionStorage,i="sessionStorage"):(u=e.localStorage,i="localStorage")}catch(e){return}return{type:i,set:function(e,n){for(var r=JSON.parse(u.getItem(o))||[],i=!1,s=0;s<r.length;s++)if(r[s][c]===e[c]){i=!0,r[s]=e;break}i||r.push(e),u.setItem(o,JSON.stringify(r)),t(n,null,e)},setAll:function(e,n){for(var r=function(e,n){var r=[];return{countDown:function(o){r.push(o),r.length===e&&t(n,null,r)}}}(e.length,n),o=0;o<e.length;o++){var c=e[o];this.set(c,r.countDown)}},get:function(e,n){var r=u.getItem(o);if(r){for(var i=JSON.parse(r)||[],s=0;s<i.length;s++)if(i[s][c]===e)return void t(n,null,i[s]);return t(n)}t(n)},getAll:function(e){var n=u.getItem(o);t(e,null,n?JSON.parse(n):[])},remove:function(e,n){t(n);var r=u.getItem(o);if(r)for(var i=JSON.parse(r),s=0;s<i.length;s++)if(i[s][c]===e)return i.splice(s,1),void u.setItem(o,JSON.stringify(i))},removeAll:function(e){u.removeItem(o),t(e)},close:function(){}}},c=function(e){return o(e,!0)},u="storagedb",i=function(n){function c(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];h?S[e].apply(S,n):m.push(function(){return S[e].apply(S,n)})}}function i(e){v("IndexedDB: going to create objectStore "+g),h.close();var t=h.version+1,n=p.open(u,t);n.onupgradeneeded=function(){(h=n.result).createObjectStore(g,{keyPath:d})},n.onsuccess=function(){v("IndexedDB: created objectStore "+g),e()},n.onerror=function(t){return e(t)}}function s(){var e=h.transaction([g],"readwrite");return e.onerror=f,e.objectStore(g)}function l(e){r(S,e);for(var t=0;t<m.length;t++){(0,m[t])()}}function a(e){v("An error ocurred: switching to localStorage",e),v("pending:",m),l(o)}function f(e){v("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)}var g=n.name,d=n.id,v=n.debug,p=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB,h=void 0,m=[],y=/Trident\/|MSIE|Edge\//.test(e.navigator.userAgent);if(!p||y)return!1;var b=p.open(u);b.onsuccess=function(){(h=b.result).objectStoreNames.contains(g)?(v("pending:",m),l(A)):i(function(e){if(e)return a(e);v("pending:",m),l(A)})},b.onerror=a;var S={type:"indexedDB",set:c("set"),setAll:c("setAll"),get:c("get"),getAll:c("getAll"),remove:c("remove"),removeAll:c("removeAll"),close:c("close")},A={set:function(e,n){try{var r=s().put(e);r.onsuccess=function(){return t(n,null,e)},r.onerror=f}catch(r){3!==r.code&&8!==r.code?(f(r),t(n,r)):(v("IndexedDB: going to create objectStore "+g),i(function(){A.set(e,n)}))}},setAll:function(e,n){var r=function(e,n,r){var o=0;return{next:function(){o<e.length?n(e[o++]):t(r,null,e)}}}(e,function(e){A.set(e,r.next)},n);r.next()},get:function(e,n){try{s().get(e).onsuccess=function(e){t(n,null,e.target.result)}}catch(e){f(e),t(n,e)}},getAll:function(e){try{var n=s();if(n.getAll)n.getAll().onsuccess=function(n){t(e,null,n.target.result)};else{var r=[];n.openCursor().onsuccess=function(n){var o=n.target.result;o?(r.push(o.value),o.continue()):t(e,null,r)}}}catch(n){t(e,n,[])}},remove:function(e,n){if(h.objectStoreNames.contains(g)){var r=s().delete(e);r.onerror=r.onsuccess=function(){return t(n)}}else v("IndexedDB: missing objectStore "+g),t(n)},removeAll:function(e){try{var n=s().clear();n.onerror=n.onsuccess=function(){t(e)}}catch(e){3!==e.code&&8!==e.code&&f(e)}},close:function(){h.close()}};return S};return function(e,t){if("object"===n(e)&&(e=(t=e).name),t=r({name:e,type:null,id:"id",debug:!1},t||{}),t.debug=t.debug?function(){var e;return(e=console).log.apply(e,arguments)}:function(){},!e)throw new Error("you must pass in a entity to storageSet");var u={"indexed-db":i,"local-storage":o,"session-storage":c},s=Object.keys(u);t.type&&s.unshift(t.type);for(var l=0;l<s.length;l++){var a=s[l],f=u[a]&&u[a](t);if(f)return f.clear=f.removeAll,f}throw new Error("You can only use one of these types for storagedb "+s.join(", "))}}(window);
