var storagedb=function(e){"use strict";function t(e){if(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];n.length||(n[0]=null),e.apply(void 0,n)}}function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),c=1;c<t;c++)r[c-1]=arguments[c];for(var s=0;s<r.length;s++){var i=r[s];for(var a in i)i.hasOwnProperty(a)&&("object"===n(i[a])?e[a]="object"===n(e[a])?o(e[a],i[a]):i[a]:e[a]=i[a])}return e}e=e&&e.hasOwnProperty("default")?e.default:e;var r=function(n,o){var r=n.name,c=n.id,s=void 0,i=void 0;try{o?(s=e.sessionStorage,i="sessionStorage"):(s=e.localStorage,i="localStorage")}catch(e){return}return{type:i,set:function(e,n){for(var o=JSON.parse(s.getItem(r))||[],i=!1,a=0;a<o.length;a++)o[a][c]===e[c]&&(i=!0,o[a]=e);i||o.push(e),s.setItem(r,JSON.stringify(o)),t(n)},setAll:function(e,t){for(var n=function(e,t){var n=[];return{countDown:function(o){n.push(o),n.length===e&&t(n)}}}(e.length,t),o=0;o<e.length;o++){var r=e[o];this.set(r,n.countDown)}},get:function(e,n){var o=s.getItem(r);if(o){for(var i=JSON.parse(o)||[],a=0;a<i.length;a++)if(i[a][c]===e)return void t(n,null,i[a]);return t(n)}t(n)},getAll:function(e){var n=s.getItem(r);t(e,null,n?JSON.parse(n):[])},remove:function(e,n){t(n);var o=s.getItem(r);if(o)for(var i=JSON.parse(o),a=0;a<i.length;a++)if(i[a][c]===e)return i.splice(a,1),void s.setItem(r,JSON.stringify(i))},removeAll:function(e){s.removeItem(r),t(e)},close:function(){}}},c=function(e){return r(e,!0)},s="storagedb",i=function(n){function c(e){return function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];g?h[e].apply(h,n):v.push(function(){return h[e].apply(h,n)})}}function i(e){g.close();var t=g.version+1,n=f.open(s,t);n.onupgradeneeded=function(){(g=n.result).createObjectStore(u,{keyPath:l})},n.onsuccess=function(t){return e(null,t)}}function a(e){o(h,e);for(var t=0;t<v.length;t++){(0,v[t])()}}var u=n.name,l=n.id,d=n.debug,f=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB,g=void 0,v=[],m=/Trident\/|MSIE|Edge\//.test(e.navigator.userAgent);if(!f||m)return!1;var p=f.open(s);p.onsuccess=function(){g=p.result,a(b),d("pending:",v)},p.onerror=function(e){d("An error ocurred: switching to localStorage",e),a(r)};var h={type:"indexedDB",set:c("set"),setAll:c("setAll"),get:c("get"),getAll:c("getAll"),remove:c("remove"),removeAll:c("removeAll"),close:c("close")},b={set:function(e,n){try{if(!g.objectStoreNames.contains(u))return d("IndexedDB: going to create objectStore "+u),void i(function(){d("IndexedDB: created objectStore "+u),b.set(e,n)});var o=g.transaction([u],"readwrite"),r=o.objectStore(u).put(e);o.onerror=function(e){d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)},r.onsuccess=function(e){return t(n,null,e)},r.onerror=function(e){d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)}}catch(o){3!==o.code&&8!==o.code?(d("IndexedDB Error: "+o.message+" (Code "+o.code+")",o),t(n,o)):(d("IndexedDB: going to create objectStore "+u),i(function(){b.set(e,n)}))}},setAll:function(e,t){var n=function(e,t,n){var o=0;return{next:function(){o<e.length?t(e[o++]):n()}}}(e,function(e){b.set(e,n.next)},t);n.next()},get:function(e,n){try{if(g.objectStoreNames.contains(u)){var o=g.transaction([u],"readwrite");o.onerror=function(e){d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)};o.objectStore(u).get(e).onsuccess=function(e){t(n,null,e.target.result)}}else d("IndexedDB: missing objectStore "+u),t(n)}catch(e){d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e),t(n,e)}},getAll:function(e){try{var n=[];if(g.objectStoreNames.contains(u)){var o=g.transaction([u],"readwrite");o.onerror=function(e){d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)};o.objectStore(u).openCursor().onsuccess=function(o){var r=o.target.result;r?(n.push(r.value),r.continue()):t(e,null,n)}}else d("IndexedDB: missing objectStore "+u),t(e,null,n)}catch(n){t(e,n,[])}},remove:function(e,n){if(g.objectStoreNames.contains(u)){g.transaction([u],"readwrite").objectStore(u).delete(e).onsuccess=function(){return t(n)}}else d("IndexedDB: missing objectStore "+u),t(n)},removeAll:function(e){b.close();var n=g.version+1,o=f.open(s,n);o.onupgradeneeded=function(){try{(g=o.result).objectStoreNames.contains(u)&&g.deleteObjectStore(u)}catch(e){3!==e.code&&8!==e.code&&d("IndexedDB Error: "+e.message+" (Code "+e.code+")",e)}},o.onsuccess=function(n){t(e,null,n)}},close:function(){g.close()}};return h};return function(e,t){if("object"===n(e)&&(e=(t=e).name),t=o({name:e,type:null,id:"id",debug:!1},t||{}),t.debug=t.debug?function(){var e;return(e=console).log.apply(e,arguments)}:function(){},!e)throw new Error("you must pass in a entity to storageSet");var s={"indexed-db":i,"local-storage":r,"session-storage":c},a=Object.keys(s);t.type&&a.unshift(t.type);for(var u=0;u<a.length;u++){var l=a[u],d=s[l]&&s[l](t);if(d)return d.clear=d.removeAll,d}throw new Error("You can only use one of these types for storagedb "+a.join(", "))}}(window);
